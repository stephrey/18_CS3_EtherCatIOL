{"payload":{"meta":{"Graph":{"@Type":"81297157","@Value":{"Guid":"(Guid)0afc91e4-6d0c-408c-b12f-11ba6cfd0f3c","ParentGuid":"(Guid)6e77b2a9-da24-4be1-9a55-76d3fc7b7caa","Name":"(string)PRG_IOL_Call","Properties":{"@Type":"2c41fa04:IDictionary","@Value":{}},"TypeGuid":"(Guid)6f9dac99-8de1-4efc-8465-68ac443b7d08","EmbeddedTypeGuids":{"@Type":"[Guid]","@Value":["(Guid)a9ed5b7e-75c5-4651-af16-d2c27e98cb94","(Guid)3b83b776-fb25-43b8-99f2-3c507c9143fc"]}}},"TypeInfos":{"2c41fa04":"{2c41fa04-1834-41c1-816e-303c7aa2c05b}","81297157":"{81297157-7ec9-45ce-845e-84cab2b88ade}","Guid":"System.Guid","string":"System.String"}},"object":{"Graph":{"@Type":"6f9dac99","@Value":{"SpecialFunc":{"@Type":"0db3d7bb:Enum","@Value":"None"},"Implementation":{"@Type":"3b83b776","@Value":{"TextDocument":{"@Type":"f3878285","@Value":{"TextBlobForSerialisation":"(string)\t// 765-1701\n\t// Objekt \"Portkonfiguration\" (Port configuration)\n\t// length = 1 byte\n\t// Idx = 64 (0x40)\n\t// Sub-Idx = 0\t\n\t\n\t// 765-1701\n\t// Product Text\n\t// Idx = 20\n\t// Sub-Idx = 0\n\t\n(* state machine *)\nCASE iState OF\n\t0\t:\t(* wait for command *)\n\t\t\tIF xIOL_Call_RD_ProdText THEN\n\t\t\t\tusiIOL_Call_Port;\n\t\t\t\tiState := 10;\n\t\t\tELSIF xIOL_Call_WR_HubConfig THEN\n\t\t\t\tusiIOL_Call_Port;\n\t\t\t\tabIOLhubConfig[0];\n\t\t\t\tabIOLhubConfig[1];\n\t\t\t\tiState := 20;\n\t\t\tEND_IF\n\t\t\tIF (abIOLhubConfig[0] <> abIOLhubConfig_[0]) OR (abIOLhubConfig[1] <> abIOLhubConfig_[1]) THEN\n\t\t\t\txIOL_Call_WR_HubConfig := TRUE;\n\t\t\tEND_IF\n\t\t\tabIOLhubConfig_[0] := abIOLhubConfig[0];\n\t\t\tabIOLhubConfig_[1] := abIOLhubConfig[1];\n\t\t\t\n\t10\t:\t(* read product text, prepare cmd *)\n\t\t\tuiIOL_Call_Index := 20;\n\t\t\tusiIOL_Call_SubIndex := 0;\n\t\t\tFOR i:= 0 TO c_iBufferSize DO\n\t\t\t\taIOL_Call_Data[i] := 0;\n\t\t\tEND_FOR\n\t\t\txIOL_Call_Read_Execute := TRUE;\n\t\t\tiState := 11;\n\t\t\t\n\t11\t:\t(* wait until done *)\n\t\t\tIF xIOL_Call_Read_Err THEN\n\t\t\t\txIOL_Call_Read_Execute := FALSE;\n\t\t\t\tiState := 99;\n\t\t\tELSIF xIOL_Call_Read_Done THEN\n\t\t\t\tiState := 12;\n\t\t\tEND_IF\n\t\t\t\n\t12\t:\t(* parse product text response *)\n\t\t\tMemCopySecure(\n\t\t\t\tpDest:= ADR(sIOL_Call_Data), \n\t\t\t\tudiDestSize:= SIZEOF(sIOL_Call_Data), \n\t\t\t\tpSource:= ADR(aIOL_Call_Data), \n\t\t\t\tudiSourceSize:= udiIOL_Call_Read_DataRD, \n\t\t\t\tbPadding:= 0);\n\t\t\txIOL_Call_Read_Execute := FALSE;\n\t\t\txIOL_Call_RD_ProdText := FALSE;\n\t\t\tiState := 0;\n\t\n\t20 \t: \t(* write IOL hub configuration, prepare cmd *)\n\t\t\tuiIOL_Call_Index := 16#40;\n\t\t\tusiIOL_Call_SubIndex := 0;\n\t\t\tFOR i:= 0 TO c_iBufferSize DO\n\t\t\t\taIOL_Call_Data[i] := 0;\n\t\t\tEND_FOR\t\t\t\t\t\t\n\t\t\tCASE usiIOL_Call_Port OF\n\t\t\t\t3\t:\tudiIOL_Call_WriteLen := 1;\n\t\t\t\t\t\taIOL_Call_Data[1] := abIOLhubConfig[0];\n\t\t\t\t5\t: \tudiIOL_Call_WriteLen := 1;\n\t\t\t\t\t\taIOL_Call_Data[1] := abIOLhubConfig[0];\n\t\t\t\t7\t: \tudiIOL_Call_WriteLen := 2;\n\t\t\t\t\t\taIOL_Call_Data[1] := abIOLhubConfig[0];\n\t\t\t\t\t\taIOL_Call_Data[2] := abIOLhubConfig[1];\n\t\t\tEND_CASE\n\t\t\t\n\t\t\txIOL_Call_Write_Execute := TRUE;\n\t\t\tiState := 21;\n\n\t21\t:\t(* wait until done *)\n\t\t\tIF xIOL_Call_Write_Err THEN\n\t\t\t\txIOL_Call_Write_Execute := FALSE;\n\t\t\t\tiState := 99;\n\t\t\tELSIF xIOL_Call_Write_Done THEN\n\t\t\t\tiState := 22;\n\t\t\tEND_IF\n\t\t\t\n\t22\t:\t(* parse product text response *)\n\t\t\txIOL_Call_Write_Execute := FALSE;\n\t\t\txIOL_Call_WR_HubConfig := FALSE;\n\t\t\tiState := 0;\t\t\t\n\t\t\t\n\t99\t:\t(* error handling *)\n\t\t\t;\n\tELSE\t\t\n\t\txIOL_Call_RD_ProdText := FALSE;\n\t\txIOL_Call_WR_HubConfig := FALSE;\n\t\tiState := 0;\nEND_CASE\n\t\n(* call instances *)\noIOL_Call_Read(\n\txExecute:= xIOL_Call_Read_Execute, \n\txAbort:= xIOL_Call_Read_Abort, \n\txDone=> xIOL_Call_Read_Done, \n\txBusy=> xIOL_Call_Read_Busy, \n\txError=> xIOL_Call_Read_Err, \n\txAborted=> xIOL_Call_Read_Aborted, \n\tusiCom:= usiIOL_Call_Com, \n\tuiDevice:= IOFLD_02_765_4201.PhysSlaveAddr, \n\tusiChannel:= usiIOL_Call_Channel, \n\tudiTimeout:= udiIOL_Call_Timeout, \n\tusiPort:= usiIOL_Call_Port, \n\tuiIndex:= uiIOL_Call_Index, \n\tusiSubIndex:= usiIOL_Call_SubIndex, \n\tudiSize:= SIZEOF(aIOL_Call_Data), \n\tpbyData:= ADR(aIOL_Call_Data), \n\tudiIndexGroup:= c_udiIndexGroup, \n\tudiResponseError=> udiIOL_Call_Read_RespErr, \n\tudiDataRead=> udiIOL_Call_Read_DataRD);\n\noIOL_Call_Write(\n\txExecute:= xIOL_Call_Write_Execute, \n\txAbort:= xIOL_Call_Write_Abort, \n\txDone=> xIOL_Call_Write_Done, \n\txBusy=> xIOL_Call_Write_Busy, \n\txError=> xIOL_Call_Write_Err, \n\txAborted=> xIOL_Call_Write_Aborted, \n\tusiCom:= usiIOL_Call_Com, \n\tuiDevice:= IOFLD_02_765_4201.PhysSlaveAddr, \n\tusiChannel:= usiIOL_Call_Channel, \n\tudiTimeout:= udiIOL_Call_Timeout, \n\tusiPort:= usiIOL_Call_Port, \n\tuiIndex:= uiIOL_Call_Index, \n\tusiSubIndex:= usiIOL_Call_SubIndex, \n\tudiSize:= udiIOL_Call_WriteLen, \n\tpbyData:= ADR(aIOL_Call_Data), \n\tudiIndexGroup:= c_udiIndexGroup, \n\tudiResponseError=> udiIOL_Call_Write_RespErr, \n\tudiDataWritten=> udiIOL_Call_Write_DataWR);\t\n","LineInfoPersistence":"(string)0afc91e4-6d0c-408c-b12f-11ba6cfd0f3c_Impl_LineIds"}}}},"Interface":{"@Type":"a9ed5b7e","@Value":{"TextDocument":{"@Type":"f3878285","@Value":{"TextBlobForSerialisation":"(string)PROGRAM PRG_IOL_Call\nVAR\n\taIOL_Call_Data\t\t\t\t: ARRAY[1..c_iBufferSize] OF BYTE;\n\tsIOL_Call_Data\t\t\t\t: STRING(c_iBufferSize);\n\t\n\tusiIOL_Call_Port\t\t\t: USINT := 1;\n\txIOL_Call_RD_ProdText\t\t: BOOL;\n\txIOL_Call_WR_HubConfig\t\t: BOOL;\n\tabIOLhubConfig\t\t\t\t: ARRAY[0..1] OF BYTE := [16#FF, 16#FF];\n\tabIOLhubConfig_\t\t\t\t: ARRAY[0..1] OF BYTE := [16#FF, 16#FF];\n\tiState\t\t\t\t\t\t: INT;\n\ti\t\t\t\t\t\t\t: INT;\n\t\n\tuiIOL_Call_Index\t\t\t: UINT := 0;\n\tusiIOL_Call_SubIndex\t\t: USINT := 0;\n\tudiIOL_Call_WriteLen\t\t: UDINT;\n\tusiIOL_Call_Com\t\t\t\t: USINT := 1;\t\t\t\t\t\t// Index of master 1: first ETC master\n\tusiIOL_Call_Channel\t\t\t: USINT := 1;\t\t\t\t\t\t// not used in the moment because channel is set automatically, always 1\n\tudiIOL_Call_Timeout\t\t\t: UDINT := 300;\n\n\t\n\toIOL_Call_Read\t\t\t\t: ETC_ADS_IoLinkRead;\n\txIOL_Call_Read_Execute\t\t: BOOL;\n\txIOL_Call_Read_Abort\t\t: BOOL;\n\txIOL_Call_Read_Done\t\t\t: BOOL;\n\txIOL_Call_Read_Busy\t\t\t: BOOL;\n\txIOL_Call_Read_Err\t\t\t: BOOL;\n\txIOL_Call_Read_Aborted\t\t: BOOL;\n\tudiIOL_Call_Read_RespErr\t: UDINT;\n\tudiIOL_Call_Read_DataRD\t\t: UDINT;\n\t\t\n\toIOL_Call_Write\t\t\t\t: ETC_ADS_IoLinkWrite;\n\txIOL_Call_Write_Execute\t\t: BOOL;\n\txIOL_Call_Write_Abort\t\t: BOOL;\n\txIOL_Call_Write_Done\t\t: BOOL;\n\txIOL_Call_Write_Busy\t\t: BOOL;\n\txIOL_Call_Write_Err\t\t\t: BOOL;\n\txIOL_Call_Write_Aborted\t\t: BOOL;\n\tudiIOL_Call_Write_RespErr\t: UDINT;\n\tudiIOL_Call_Write_DataWR\t: UDINT;\nEND_VAR\nVAR CONSTANT\n\tc_udiIndexGroup\t\t\t\t: UDINT := 16#F302;\t\t\t\t\t// Indexgroup of the Io-Link object, allways 0xF302\n\tc_iBufferSize\t\t\t\t: INT := 40;\nEND_VAR\n","LineInfoPersistence":"(string)0afc91e4-6d0c-408c-b12f-11ba6cfd0f3c_Decl_LineIds"}}}},"UniqueIdGenerator":"(string)532","POULevel":{"@Type":"8e575c5b:Enum","@Value":"Standard"},"ChildObjectGuids":{"@Type":"ArrayList:IList","@Value":[]},"AddAttributeSubsequent":"(bool)False"}},"TypeInfos":{"0db3d7bb":"{0db3d7bb-cde0-4416-9a7b-ce49a0124323}","3b83b776":"{3b83b776-fb25-43b8-99f2-3c507c9143fc}","6f9dac99":"{6f9dac99-8de1-4efc-8465-68ac443b7d08}","8e575c5b":"{8e575c5b-1d37-49c6-941b-5c0ec7874787}","a9ed5b7e":"{a9ed5b7e-75c5-4651-af16-d2c27e98cb94}","ArrayList":"System.Collections.ArrayList","bool":"System.Boolean","f3878285":"{f3878285-8e4f-490b-bb1b-9acbb7eb04db}","string":"System.String"}}},"FormatVersion":"1.0"}